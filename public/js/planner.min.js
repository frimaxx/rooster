function getTimeRange(){return calendar=$("#calendar"),currentView=calendar.fullCalendar("getView").name,"month"===currentView?{start:calendar.fullCalendar("getDate").startOf("month").unix(),end:calendar.fullCalendar("getDate").endOf("month").unix()}:"agendaWeek"===currentView?{start:calendar.fullCalendar("getDate").startOf("week").unix(),end:calendar.fullCalendar("getDate").endOf("week").unix()}:"agendaDay"===currentView&&{start:calendar.fullCalendar("getDate").startOf("day").unix(),end:calendar.fullCalendar("getDate").endOf("day").unix()}}function deleteEvent(e){data={api_token:api_token,event_id:e.event_id},$.post("/api/v1/delete/event",data,function(e,t){("success"!==t||e.hasErrors)&&(alert("Er ging iets mis tijdens het verwijderen van het event"),location.reload()),console.log(e)}),$("#calendar").fullCalendar("removeEvents",e._id);var t=$("<div class='fc-event'>").appendTo("#external-events-listing").text(e.title);t.draggable({zIndex:999,revert:!0,revertDuration:0}),ToggleActivateRoosterButton(!0),t.data("event",{title:e.title,id:e.id,stick:!0})}function editEvent(e){e.borderColor=borderColorInactive,$("#calendar").fullCalendar("updateEvent",e),data={api_token:api_token,event_id:e.event_id,start:e.start.format("YYYY-MM-DD HH:mm:ss"),end:e.end.format("YYYY-MM-DD HH:mm:ss")},$.post("/api/v1/edit/event",data,function(e,t){"success"===t&&!0!==e.hasErrors||(alert("Er kon geen verbinding worden gemaakt met de server"),location.reload()),ToggleActivateRoosterButton(!0),console.log(e)})}function addLeftToolbarButtons(){fctoolbar_left=$(".fc-toolbar .fc-left "),fctoolbar_left.append('<button id="copyLastweekButton" class="fc-button fc-state-default fc-corner-right">Vorige week overnemen</button>'),fctoolbar_left.append('<button id="activateRoosterButton" class="fc-button fc-state-default fc-corner-right">Publiceren</button>'),fctoolbar_right=$(".fc-toolbar .fc-right"),$('<button style="margin-right: 10px;" id="printButton" class="fc-button fc-state-default fc-corner-right"><i class="fa fa-print" aria-hidden="true"></i> Week Printen</button>').insertBefore(".fc-month-button"),$('<button style="margin-right: 10px;" id="emptyWeekButton" class="fc-button fc-state-default fc-corner-right">Week leegmaken</button>').insertBefore(".fc-month-button")}function ToggleActivateRoosterButton(e){e?$("#activateRoosterButton").removeClass("fc-state-disabled"):$("#activateRoosterButton").addClass("fc-state-disabled")}function copyLastWeek(){var t=$("#calendar");startOfWeek=t.fullCalendar("getDate").startOf("week").unix(),endOfWeek=t.fullCalendar("getDate").endOf("week").unix(),$.get("/api/v1/events-branch/copy-last-week/"+startOfWeek+"/"+endOfWeek+"?api_token="+api_token,function(e){!0===e.hasErrors&&alert(e.errors[0]),t.fullCalendar("removeEvents"),t.fullCalendar("refetchEvents")})}function deleteThisWeek(){var t=$("#calendar");$.get("/api/v1/events-branch/delete/"+startOfWeek+"/"+endOfWeek+"?api_token="+api_token,function(e){!0===e.hasErrors&&alert(e.errors[0]),t.fullCalendar("removeEvents"),t.fullCalendar("refetchEvents")})}function ExecuteConfirmDialog(e,t,a,n,o){var r=$("#modalConfirm");r.modal("show"),$("#lblTitleConfirmYesNo").html(e),$("#lblMsgConfirmYesNo").html(t),n&&$("#btnYesConfirmYesNo").text(n),o&&$("#btnNoConfirmYesNo").text(o),$("#btnYesConfirmYesNo").off("click").click(function(){a(),r.modal("hide")}),$("#btnNoConfirmYesNo").off("click").click(function(){r.modal("hide")})}$(document).ready(function(){var o=!0;$("#external-events").css("height",$("#aside").height()-100+"px"),$(".trash").css("height",$("#aside").height()-100+"px"),$("#external-events .fc-event").each(function(){$(this).data("event",{title:$.trim($(this).text()),stick:!0});var e={title:$.trim($(this).text())};$(this).data("eventObject",e),$(this).draggable({zIndex:999,revert:!0,revertDuration:0,drag:function(e,t){$(".UserTooltip").tooltip("hide")}})}),$("#calendar").fullCalendar({locale:"nl",timezone:"local",ignoreTimezone:!1,minTime:"07:00:00",maxTime:"22:00:00",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},defaultView:"agendaWeek",slotDuration:"00:15:00",allDaySlot:!1,navLinks:!0,selectHelper:!0,editable:!0,droppable:!0,dragRevertDuration:0,themeSystem:"standard",select:function(e,t){},drop:function(e,t,a,n){var o=$("#calendar");if(currentView=o.fullCalendar("getView").name,"month"===currentView)return!1;var r=$(this).data("eventObject"),l=$(this).attr("data-user_id");r.start=e,r.end=moment(e).add(3,"hours"),r.allDay=!1,data={api_token:api_token,start:r.start.format("YYYY-MM-DD HH:mm:ss"),end:r.end.format("YYYY-MM-DD HH:mm:ss"),user_id:l},$.post("/api/v1/new/event",data,function(e,t){"success"===t&&!0!==e.hasErrors||(alert("Er kon geen verbinding worden gemaakt met de server"),location.reload()),colors=getColorsByUserid(parseInt(l)),r=$.extend({user_id:parseInt(l),event_id:e.event.id,borderColor:borderColorInactive,backgroundColor:colors.color,textColor:colors.textColor},r),o.fullCalendar("renderEvent",r,!0)}),ToggleActivateRoosterButton(!0),$(this).css("top","0px")},eventDragStart:function(e){$("#external-events").css("display","none")},eventDragStop:function(e,t,a,n){if($("#external-events").css("display","block"),r(t.clientX,t.clientY))return deleteEvent(e)},eventDrop:function(e){editEvent(e)},eventResize:function(e){editEvent(e)},eventReceive:function(e){$("#calendar").fullCalendar("removeEvents",e._id)},events:function(e,t,a,n){o&&(addLeftToolbarButtons(),o=!1),ToggleActivateRoosterButton(!1),e=(e+="").substring(0,e.length-3),t=(t+="").substring(0,t.length-3),CurrentTimeRange[0]=e,CurrentTimeRange[1]=t,$.get("/api/v1/events-branch/timestamp/"+e+"/"+t+"?api_token="+api_token,function(e){for(var t=[],a=0;a<e.events.length;a++)event=e.events[a],event.borderColor=borderColorInactive,1===event.active?event.borderColor=borderColorActive:ToggleActivateRoosterButton(!0),color=getColorsByUserid(event.user_id),event.backgroundColor=color.color,event.textColor=color.textColor,t.push(event);$("#calendar").fullCalendar("removeEvents"),n(t)}),console.log(e+"-"+t)},timeFormat:"H(:mm)"});var r=function(e,t){var a=$(".trash"),n=a.offset();return n.right=a.width()+n.left,n.bottom=a.height()+n.top,e>=n.left&&t>=n.top&&e<=n.right&&t<=n.bottom}}),$(document).on("click","#activateRoosterButton",function(){$(this).hasClass("fc-state-disabled")||(ToggleActivateRoosterButton(!1),timeRange=getTimeRange(),data={api_token:api_token,start:timeRange.start,end:timeRange.end},$.post("/api/v1/events/activate",data,function(e,t){"success"===t&&!0!==e.hasErrors||(alert("Er kon geen verbinding worden gemaakt met de server"),location.reload()),calendar=$("#calendar"),calendar.fullCalendar("removeEvents"),calendar.fullCalendar("refetchEvents")}))}),$(document).on("click","#copyLastweekButton",function(){$(this).hasClass("fc-state-disabled")||$(this).hasClass("fc-state-disabled")||ExecuteConfirmDialog("Wilt u het rooster van vorige week overnemen?","Deze actie kan niet ongedaan gemaakt worden en verwijderd alle huidige data in deze week",copyLastWeek,"Ja","Nee")}),$(document).on("click","#emptyWeekButton",function(){if(!$(this).hasClass("fc-state-disabled")){var e=$("#calendar");startOfWeek=e.fullCalendar("getDate").startOf("week").unix(),endOfWeek=e.fullCalendar("getDate").endOf("week").unix(),ExecuteConfirmDialog("Weet u zeker dat u deze week leeg wilt maken?","Deze actie kan niet ongedaan gemaakt worden",deleteThisWeek,"Verwijderen","Annuleren")}}),$(document).on("click","#printButton",function(){if(!$(this).hasClass("fc-state-disabled")){var e=$("#calendar");startOfWeek=e.fullCalendar("getDate").startOf("week").unix(),endOfWeek=e.fullCalendar("getDate").endOf("week").unix(),window.open("/print-schedule?start="+startOfWeek+"&end="+endOfWeek,"_blank")}}),$(document).on("click",".fc-agendaWeek-button",function(){$("#copyLastweekButton").removeClass("fc-state-disabled"),$("#emptyWeekButton").removeClass("fc-state-disabled"),$("#printButton").removeClass("fc-state-disabled")}),$(document).on("click",".fc-month-button",function(){$("#copyLastweekButton").removeClass("fc-state-disabled").addClass("fc-state-disabled"),$("#emptyWeekButton").removeClass("fc-state-disabled").addClass("fc-state-disabled"),$("#printButton").removeClass("fc-state-disabled").addClass("fc-state-disabled")}),$(document).on("click",".fc-agendaDay-button",function(){$("#copyLastweekButton").removeClass("fc-state-disabled"),$("#emptyWeekButton").removeClass("fc-state-disabled"),$("#printButton").removeClass("fc-state-disabled")});